<section class="form-container">
    <h2>Novo Produto</h2>
    <form #formulario="ngForm" (ngSubmit)="onSubmit(formulario)">
        <div class="campo">
            <label for="nome">Nome</label>
            <input type="text" id="nome" name="nome" [(ngModel)]="novoProduto.nome" required minlength="3"/>
            <small class="erro" [hidden]="!(formulario.submitted && formulario.controls['nome'].invalid)">
                Nome é obrigatório com ao menos 3 caracteres      
            </small>
        </div>
        <div class="campo">
            <label for="preco">Preco</label>
            <input type="number" id="preco" name="preco" [(ngModel)]="novoProduto.preco" required min=0/>
            @if (formulario.controls['preco']?.dirty && formulario.controls['preco'].invalid){
                <small class="erro">Informe preco válido.</small>
            }
        </div>
        <div class="campo">
            <label for="descricao">Descricao</label>
            <textarea id="descricao" name="descricao" [(ngModel)]="novoProduto.descricao" required></textarea>
            @if (formulario.controls['descricao']?.dirty && formulario.controls['descricao'].invalid){
                <small class="erro">Informe uma descricao.</small>
            }
        </div>
        <div class="campo">
            <label for="categoria">Categoria</label>
            <select name="categoria" id="categoria" [(ngModel)]="categoriaSelecionada" required="">
                <option value="">Selecione...</option>
                @for (categoria of categorias(); track categoria) {
                    <option [value]="categoria"> {{categoria}} </option>
                }
            </select>
            @if (!(formulario.controls['categoria']?.dirty && formulario.controls['categoria'].invalid)) {
                <small class="erro">Selecione uma categoria</small>
            }
            
        </div>

        @if (mostrarNovaCategoria()) {
            <div class="campo">
                <label for="novaCategoria">Nova Categoria</label>
                <input type="text" name="novaCategoria" id="novaCategoria" [(ngModel)]="novaCategoria" required placeholder="Digite a nova Categoria">

                @if (mostrarNovaCategoria() && formulario.controls['novaCategoria']?.dirty && novaCategoria().trim().length== 0) {
                    <small class="erro">Digite a nova categoria</small>
                }
            </div>
        }

        <div class="campo">
            <label for="imageUrl">URL da imagem</label>
            <input type="text" name="imageUrl" id="imageUrl" [(ngModel)]="novoProduto.imageURL" required>
            @if (formulario.controls['imageUrl']?.dirty && formulario.controls['imageUrl'].invalid) {
                <small class="erro">Informe o URL da imagem</small>
            }
        </div>

        <div class="campo check">
            <label for="promo">
                <input type="checkbox" name="promo" id="promo" [(ngModel)]="novoProduto.promo">
                Em Promoção
            </label>
        </div>

        <div class="botoesform">
            <button type="submit" [disabled]="enviando()">Salvar Produto</button>
            <button type="button" class="botaocancelar" (click)="onReturnToList()">Cancelar</button>
        </div>

        @if (mensagem()) {
            <p class="mensagem"> {{mensagem()}} </p>
        }

    </form>
</section>